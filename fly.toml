# fly.toml for BioMCP (HTTP/SSE transport)

app = "biomcp"
primary_region = "iad"

# Run the HTTP server explicitly (no reliance on container CMD)
[processes]
  app = "biomcp run --mode streamable_http --host 0.0.0.0 --port 8000"

[env]
  MCP_MODE = "streamable_http"
  BIOMCP_HOST = "0.0.0.0"
  BIOMCP_PORT = "8000"
  # Add your keys here or via fly secrets:
  # NCI_API_KEY = ""
  # CBIO_TOKEN = ""

[http_service]
  internal_port = 8000
  force_https = true
  auto_stop_machines = "off"
  auto_start_machines = true
  min_machines_running = 1
  processes = ["app"]

  # Optional health check; comment out if your build has no /health
  [http_service.concurrency]
    type = "connections"
    soft_limit = 50
    hard_limit = 100

  [[http_service.checks]]
    method = "GET"
    path = "/health"
    interval = "15s"
    timeout = "3s"
    grace_period = "10s"

# VM sizing
[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 4096
